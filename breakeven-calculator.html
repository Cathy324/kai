<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ä¿æœ¬å‡ºä¸€åŠè¨ˆç®—å™¨</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 2rem;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 1.5rem;
      border-radius: 1rem;
      max-width: 500px;
      margin: auto;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    label {
      font-weight: bold;
      display: block;
      margin-top: 1rem;
    }
    input, select {
      width: 100%;
      padding: 0.5rem;
      margin-top: 0.25rem;
      border: 1px solid #ccc;
      border-radius: 0.5rem;
    }
    .result {
      background: #eef;
      padding: 1rem;
      margin-top: 1.5rem;
      border-radius: 0.5rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>ğŸ“ˆ ä¿æœ¬å‡ºä¸€åŠè¨ˆç®—å™¨</h2>

    <label>æ–¹å‘</label>
    <select id="direction">
      <option value="long">åšå¤š</option>
      <option value="short">åšç©º</option>
    </select>

    <label>é–‹å€‰åƒ¹æ ¼</label>
    <input type="number" id="entry" value="0.651" step="0.0001">

    <label>åœæåƒ¹æ ¼</label>
    <input type="number" id="stop" value="0.645" step="0.0001">

    <label>é¸æ“‡æå¤±è¼¸å…¥æ–¹å¼</label>
    <select id="lossType">
      <option value="usd">è¼¸å…¥æå¤±é‡‘é¡ï¼ˆç¾å…ƒï¼‰</option>
      <option value="percent">è¼¸å…¥æå¤±ç™¾åˆ†æ¯”ï¼ˆ%ï¼‰</option>
    </select>

    <div id="lossUsdContainer">
      <label>é è¨ˆç¸½æå¤±ï¼ˆç¾å…ƒï¼‰</label>
      <input type="number" id="lossUsd" value="6.44" step="0.01">
    </div>

    <div id="lossPercentContainer" style="display:none">
      <label>é è¨ˆæå¤±ç™¾åˆ†æ¯”ï¼ˆ%ï¼‰</label>
      <input type="number" id="lossPercent" value="2" step="0.1">
    </div>

    <div class="result" id="output"></div>
  </div>

  <script>
    const entryInput = document.getElementById('entry');
    const stopInput = document.getElementById('stop');
    const lossUsdInput = document.getElementById('lossUsd');
    const lossPercentInput = document.getElementById('lossPercent');
    const directionInput = document.getElementById('direction');
    const lossTypeInput = document.getElementById('lossType');
    const lossUsdContainer = document.getElementById('lossUsdContainer');
    const lossPercentContainer = document.getElementById('lossPercentContainer');
    const output = document.getElementById('output');

    function toggleLossInput() {
      if (lossTypeInput.value === 'usd') {
        lossUsdContainer.style.display = 'block';
        lossPercentContainer.style.display = 'none';
      } else {
        lossUsdContainer.style.display = 'none';
        lossPercentContainer.style.display = 'block';
      }
      calculate();
    }

    function calculate() {
      const entry = parseFloat(entryInput.value);
      const stop = parseFloat(stopInput.value);
      const direction = directionInput.value;
      const lossType = lossTypeInput.value;
      const buyFee = 0.0002;
      const sellFee = 0.0004;

      let loss;

      let entryCost, stopNet;

      if (direction === "long") {
        entryCost = entry * (1 + buyFee);
        stopNet = stop * (1 - sellFee);
      } else {
        entryCost = entry * (1 - sellFee);
        stopNet = stop * (1 + buyFee);
      }

      const perUnitLoss = Math.abs(entryCost - stopNet);

      if (lossType === 'usd') {
        loss = parseFloat(lossUsdInput.value);
      } else {
        loss = entryCost * parseFloat(lossPercentInput.value) / 100;
      }

      const positionSize = loss / perUnitLoss;
      const halfPosition = positionSize / 2;

      let targetPrice;
      if (direction === "long") {
        targetPrice = (entryCost + (loss / 2 / halfPosition)) / (1 - sellFee);
      } else {
        targetPrice = (entryCost - (loss / 2 / halfPosition)) / (1 + buyFee);
      }

      output.innerHTML = `
        ğŸ” æ–¹å‘ï¼š<strong>${direction === 'long' ? 'åšå¤š' : 'åšç©º'}</strong><br>
        ğŸ§® å€‰ä½ç¸½æ•¸é‡ï¼š<strong>${positionSize.toFixed(2)}</strong> å–®ä½<br>
        â— æ¯åŠå€‰ä½ï¼š<strong>${halfPosition.toFixed(2)}</strong> å–®ä½<br>
        ğŸ¯ ä¿æœ¬å‡ºä¸€åŠåƒ¹æ ¼ï¼š<strong>${targetPrice.toFixed(5)}</strong><br>
        âŒ æ¯å–®ä½åœææå¤±ï¼š<strong>${perUnitLoss.toFixed(5)}</strong> ç¾å…ƒ<br>
        ğŸ’¸ é ä¼°ç¸½æå¤±ï¼š<strong>${loss.toFixed(2)}</strong> ç¾å…ƒ
      `;
    }

    entryInput.addEventListener('input', calculate);
    stopInput.addEventListener('input', calculate);
    lossUsdInput.addEventListener('input', calculate);
    lossPercentInput.addEventListener('input', calculate);
    directionInput.addEventListener('change', calculate);
    lossTypeInput.addEventListener('change', toggleLossInput);

    toggleLossInput();
  </script>
</body>
</html>
